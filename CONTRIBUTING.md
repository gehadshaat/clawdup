# Contributing to clawdup

This guide takes you from a fresh clone to your first clawdup-driven PR. It sequences the existing documentation so you know what to read, when.

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Local Setup](#local-setup)
3. [Verifying Your Setup](#verifying-your-setup)
4. [Project Structure](#project-structure)
5. [Understanding the Docs](#understanding-the-docs)
6. [Your First Contribution](#your-first-contribution)
7. [Coding Conventions](#coding-conventions)
8. [Git Conventions](#git-conventions)
9. [FAQ](#faq)

---

## Prerequisites

Before you start, make sure you have the following installed:

| Tool | Version | Install |
| ---- | ------- | ------- |
| **Node.js** | 18+ | [nodejs.org](https://nodejs.org/) |
| **Git** | Any recent | [git-scm.com](https://git-scm.com/) |
| **GitHub CLI** (`gh`) | Any recent | [cli.github.com](https://cli.github.com/) |
| **Claude Code CLI** (`claude`) | Any recent | [docs.anthropic.com/en/docs/claude-code](https://docs.anthropic.com/en/docs/claude-code) |

Authenticate the GitHub CLI before proceeding:

```bash
gh auth login
```

---

## Local Setup

```bash
# 1. Clone the repo
git clone git@github.com:gehadshaat/clawdup.git
cd clawdup

# 2. Install dev dependencies
npm install

# 3. Build the project
npm run build

# 4. Link globally so the 'clawdup' command is available
npm link
```

---

## Verifying Your Setup

### Configuration check

Set up a `.clawdup.env` file (see [Configuration](CONFIGURATION.md)) then run:

```bash
clawdup --check
```

This validates that your API token, list ID, CLI tools, and statuses are all configured correctly.

### Dry-run mode

Test the full pipeline without making any real changes:

```bash
clawdup --dry-run
```

Dry-run simulates a single poll cycle — reads tasks from ClickUp, logs what actions *would* be taken (branch creation, Claude invocation, PR creation, status updates), and exits with no side effects.

### Single-task mode

Process exactly one task and stop:

```bash
clawdup --once <task-id>
```

These modes are described in more detail in the [Complete Setup & Usage Guide](GUIDE.md) and the [CLI Reference in the README](README.md#cli-reference).

---

## Project Structure

```
src/
  cli.ts           # CLI entry point, argument parsing
  config.ts        # Configuration loading (env → .clawdup.env → clawdup.config.mjs)
  types.ts         # TypeScript interfaces
  clickup-api.ts   # ClickUp API v2 REST client
  git-ops.ts       # Git and GitHub CLI operations
  claude-worker.ts # Claude Code invocation, JSONL stream parsing
  runner.ts        # Main orchestration engine, task lifecycle
  setup.ts         # Interactive setup wizard
  index.ts         # Public API exports
bin/
  clawdup.js       # CLI shim (#!/usr/bin/env node)
dist/              # Compiled output (generated by `npm run build`)
```

Each module has a focused responsibility with named exports. See [ARCHITECTURE.md](ARCHITECTURE.md) for the full design, state flow, and module interaction diagrams.

---

## Understanding the Docs

Read these in order based on what you're working on:

### Start here (everyone)

| Doc | What it covers | When to read |
| --- | -------------- | ------------ |
| [README.md](README.md) | Quick start, installation, CLI reference | First — get oriented |
| [GUIDE.md](GUIDE.md) | End-to-end setup walkthrough | Setting up for the first time |
| [ARCHITECTURE.md](ARCHITECTURE.md) | Internal design, state machine, module responsibilities | Before touching any source code |

### Before writing code

| Doc | What it covers | When to read |
| --- | -------------- | ------------ |
| [CONFIGURATION.md](CONFIGURATION.md) | All config options, validation rules, config cascade | When working on config loading or adding new options |
| [PROMPT_SAFETY.md](PROMPT_SAFETY.md) | Prompt injection prevention, content sanitization | Before modifying prompt building or task content handling |
| [CLAUDE.md](CLAUDE.md) | Project conventions for Claude Code (also useful for humans) | Quick reference for coding and git conventions |

### When things go wrong

| Doc | What it covers | When to read |
| --- | -------------- | ------------ |
| [TROUBLESHOOTING.md](TROUBLESHOOTING.md) | Common failures, recovery steps, debugging tips | When a run fails or produces unexpected results |

### Releasing

| Doc | What it covers | When to read |
| --- | -------------- | ------------ |
| [RELEASING.md](RELEASING.md) | NPM publishing checklist | When cutting a new release (maintainers) |

---

## Your First Contribution

1. **Pick a task.** Look for a well-scoped improvement or bug fix in the ClickUp list. Smaller tasks (documentation fixes, log messages, config validation) are great starting points.

2. **Understand the workflow.** clawdup automates the ClickUp → branch → Claude → PR pipeline. Your contribution might be to clawdup itself (this repo) or to a project *using* clawdup. For contributing to clawdup itself:

3. **Create a branch** following the naming convention:
   ```bash
   git checkout -b clickup/CU-<task-id>-<short-slug>
   ```

4. **Make your changes.** Keep `npm run build` passing — TypeScript strict mode is the primary correctness check. There is no linter configured, so the compiler is your safety net.

5. **Test locally.** Use `--dry-run` and `--once` modes to verify your changes work end-to-end without affecting production tasks.

6. **Commit** using the required format:
   ```bash
   git commit -m '[CU-<task-id>] Short description of changes'
   ```

7. **Push and create a PR:**
   ```bash
   git push -u origin HEAD
   gh pr create --title '[CU-<task-id>] Short description' --body 'Description of changes'
   ```

---

## Coding Conventions

These are enforced by TypeScript strict mode and project convention:

- **Naming:** `camelCase` for functions/variables, `PascalCase` for types/interfaces, `SCREAMING_SNAKE_CASE` for constants
- **Async:** Always use `async`/`await` (no raw Promise chains)
- **Imports:** Use `.js` extension in import paths (required by NodeNext module resolution)
- **Error handling:** `try`/`catch` with descriptive messages; non-critical failures log warnings but don't crash
- **Exports:** Named exports only — no default exports
- **Dependencies:** Zero runtime dependencies. Use Node built-ins and shelled-out CLI tools

See [CLAUDE.md](CLAUDE.md) for the complete conventions reference.

---

## Git Conventions

| Artifact | Format | Example |
| -------- | ------ | ------- |
| Branch | `{prefix}/CU-{task-id}-{slug}` | `clickup/CU-abc123-add-auth` |
| Commit | `[CU-{task-id}] {description}` | `[CU-abc123] Add auth module` |
| PR title | `[CU-{task-id}] {description}` | `[CU-abc123] Add auth module` |

The `CU-{task-id}` prefix enables ClickUp's GitHub integration to auto-link branches, commits, and PRs to tasks.

---

## FAQ

### Where do I get a ClickUp API token?

Click your avatar in ClickUp → **Settings → Apps** → under "API Token", click **Generate**. The token looks like `pk_12345678_XXXX...`. See the [README ClickUp Setup section](README.md#4-generate-a-clickup-api-token) for details.

### How do I safely test changes without affecting production tasks?

Use `--dry-run` mode — it simulates the full pipeline without making any real changes (no branches, no PRs, no status updates). For testing with real side effects on a single task, use `--once <task-id>` pointed at a test ClickUp list.

### How do I find my ClickUp List ID?

Open your list in ClickUp → click **"..."** → **"Copy Link"**. The List ID is the number at the end of the URL. See the [README](README.md#5-find-your-list-id) for a walkthrough.

### Do I need a ClickUp account to contribute code?

Not necessarily. You can work on code changes, build, and verify TypeScript compilation without a ClickUp account. However, to test the full pipeline end-to-end, you'll need a ClickUp workspace with an API token and a test list.

### How do I run the project after making changes?

```bash
npm run build      # Compile TypeScript
clawdup --check    # Verify configuration
clawdup --dry-run  # Test without side effects
```

### What if my build fails?

Run `npm run build` and read the TypeScript errors. The project uses strict mode, so common issues include missing type annotations, unused variables, and incorrect import paths (remember to use `.js` extensions).

### Can I add runtime dependencies?

The project intentionally has zero runtime dependencies. If you need functionality beyond Node built-ins, shell out to a CLI tool or implement it directly. Discuss with maintainers before introducing any new dependency.
